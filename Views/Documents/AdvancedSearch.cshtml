@model List<IntranetDocumentos.Models.Document>
@{
    ViewData["Title"] = "Busca Avançada de Documentos";
    var departamentos = ViewBag.Departments as List<IntranetDocumentos.Models.Department>;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
        <i class="bi bi-search"></i> Busca Avançada de Documentos
    </h2>
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Voltar para Lista
    </a>
</div>

<form asp-action="AdvancedSearch" method="post" class="row g-3 mb-4">
    <div class="col-md-4">
        <label for="searchTerm" class="form-label">Termo de busca</label>
        <input type="text" class="form-control" id="searchTerm" name="searchTerm" value="@ViewBag.SearchTerm" placeholder="Nome, conteúdo, etc">
    </div>
    <div class="col-md-2">
        <label for="departmentId" class="form-label">Departamento</label>
        <select class="form-select" id="departmentId" name="departmentId">
            <option value="">Todos</option>
            @if (departamentos != null)
            {
                foreach (var dep in departamentos)
                {
                    var selected = (ViewBag.DepartmentId != null && (int)ViewBag.DepartmentId == dep.Id) ? "selected" : null;
                    <option value="@dep.Id" selected="@selected">@dep.Name</option>
                }
            }
        </select>
    </div>
    <div class="col-md-2">
        <label for="contentType" class="form-label">Tipo</label>
        <input type="text" class="form-control" id="contentType" name="contentType" value="@ViewBag.ContentType" placeholder="Ex: pdf, docx">
    </div>
    <div class="col-md-2">
        <label for="startDate" class="form-label">Data inicial</label>
        <input type="date" class="form-control" id="startDate" name="startDate" value="@(ViewBag.StartDate != null ? ((DateTime)ViewBag.StartDate).ToString("yyyy-MM-dd") : "")">
    </div>
    <div class="col-md-2">
        <label for="endDate" class="form-label">Data final</label>
        <input type="date" class="form-control" id="endDate" name="endDate" value="@(ViewBag.EndDate != null ? ((DateTime)ViewBag.EndDate).ToString("yyyy-MM-dd") : "")">
    </div>
    <div class="col-12">
        <button type="submit" class="btn btn-primary"><i class="bi bi-search"></i> Buscar</button>
        <a asp-action="Index" class="btn btn-secondary ms-2">Voltar</a>
    </div>
</form>

@if (Model != null && Model.Count > 0)
{
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Nome</th>
                    <th>Departamento</th>
                    <th>Tipo</th>
                    <th>Data</th>
                    <th>Tamanho</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var doc in Model)
                {
                    <tr>
                        <td>@doc.OriginalFileName</td>
                        <td>@doc.Department?.Name ?? "Geral"</td>
                        <td>@doc.ContentType</td>
                        <td>@doc.UploadDate.ToString("dd/MM/yyyy")</td>
                        <td>@(doc.FileSize / 1024) KB</td>
                        <td>
                            <a asp-action="Details" asp-route-id="@doc.Id" class="btn btn-sm btn-outline-info"><i class="bi bi-eye"></i> Detalhes</a>
                            <a asp-action="Download" asp-route-id="@doc.Id" class="btn btn-sm btn-outline-success ms-1"><i class="bi bi-download"></i> Baixar</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else if (Model != null)
{
    <div class="alert alert-warning">Nenhum documento encontrado para os filtros informados.</div>
}
